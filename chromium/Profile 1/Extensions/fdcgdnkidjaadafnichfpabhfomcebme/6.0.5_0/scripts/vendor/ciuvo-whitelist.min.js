/* Ciuvo Addon SDK 2.0.9 | (c) 2011-2017 Ciuvo GmbH CIUVO CONFIDENTIAL All Rights Reserved.
NOTICE: All information contained herein is, and remains the property of  Ciuvo GmbH and its suppliers, if any. The intellectual and technical  concepts contained herein are proprietary to Ciuvo GmbH and its suppliers  and may be covered by U.S. and Foreign Patents, patents in process, and are  protected by trade secret or copyright law. Dissemination of this information  or reproduction of this material is strictly forbidden unless prior written  permission is obtained from Ciuvo GmbH.
Copyright 2011-2017 Ciuvo GmbH. Contact support@ciuvo.com for more details.

Includes jQuery | (c) jQuery Foundation and other contributors | https://jquery.org/
Includes requirejs/almond | (c) jQuery Foundation and other contributors  | https://github.com/requirejs/almond/blob/master/LICENSE
Includes json2.js | http://www.JSON.org/js.html */
!function(t,e){t.ciuvoSDK=e()}(this,function(){var t,e,i;return function(n){function r(t,e){return _.call(t,e)}function o(t,e){var i,n,r,o,s,u,a,c,f,l,h,p,d=e&&e.split("/"),m=y.map,g=m&&m["*"]||{};if(t){for(t=t.split("/"),s=t.length-1,y.nodeIdCompat&&q.test(t[s])&&(t[s]=t[s].replace(q,"")),"."===t[0].charAt(0)&&d&&(p=d.slice(0,d.length-1),t=p.concat(t)),f=0;f<t.length;f++)if(h=t[f],"."===h)t.splice(f,1),f-=1;else if(".."===h){if(0===f||1===f&&".."===t[2]||".."===t[f-1])continue;f>0&&(t.splice(f-1,2),f-=2)}t=t.join("/")}if((d||g)&&m){for(i=t.split("/"),f=i.length;f>0;f-=1){if(n=i.slice(0,f).join("/"),d)for(l=d.length;l>0;l-=1)if(r=m[d.slice(0,l).join("/")],r&&(r=r[n])){o=r,u=f;break}if(o)break;!a&&g&&g[n]&&(a=g[n],c=f)}!o&&a&&(o=a,u=c),o&&(i.splice(0,u,o),t=i.join("/"))}return t}function s(t,e){return function(){var i=b.call(arguments,0);return"string"!=typeof i[0]&&1===i.length&&i.push(null),p.apply(n,i.concat([t,e]))}}function u(t){return function(e){return o(e,t)}}function a(t){return function(e){g[t]=e}}function c(t){if(r(v,t)){var e=v[t];delete v[t],w[t]=!0,h.apply(n,e)}if(!r(g,t)&&!r(w,t))throw new Error("No "+t);return g[t]}function f(t){var e,i=t?t.indexOf("!"):-1;return i>-1&&(e=t.substring(0,i),t=t.substring(i+1,t.length)),[e,t]}function l(t){return function(){return y&&y.config&&y.config[t]||{}}}var h,p,d,m,g={},v={},y={},w={},_=Object.prototype.hasOwnProperty,b=[].slice,q=/\.js$/;d=function(t,e){var i,n=f(t),r=n[0];return t=n[1],r&&(r=o(r,e),i=c(r)),r?t=i&&i.normalize?i.normalize(t,u(e)):o(t,e):(t=o(t,e),n=f(t),r=n[0],t=n[1],r&&(i=c(r))),{f:r?r+"!"+t:t,n:t,pr:r,p:i}},m={require:function(t){return s(t)},exports:function(t){var e=g[t];return"undefined"!=typeof e?e:g[t]={}},module:function(t){return{id:t,uri:"",exports:g[t],config:l(t)}}},h=function(t,e,i,o){var u,f,l,h,p,y,_=[],b=typeof i;if(o=o||t,"undefined"===b||"function"===b){for(e=!e.length&&i.length?["require","exports","module"]:e,p=0;p<e.length;p+=1)if(h=d(e[p],o),f=h.f,"require"===f)_[p]=m.require(t);else if("exports"===f)_[p]=m.exports(t),y=!0;else if("module"===f)u=_[p]=m.module(t);else if(r(g,f)||r(v,f)||r(w,f))_[p]=c(f);else{if(!h.p)throw new Error(t+" missing "+f);h.p.load(h.n,s(o,!0),a(f),{}),_[p]=g[f]}l=i?i.apply(g[t],_):void 0,t&&(u&&u.exports!==n&&u.exports!==g[t]?g[t]=u.exports:l===n&&y||(g[t]=l))}else t&&(g[t]=i)},t=e=p=function(t,e,i,r,o){if("string"==typeof t)return m[t]?m[t](e):c(d(t,e).f);if(!t.splice){if(y=t,y.deps&&p(y.deps,y.callback),!e)return;e.splice?(t=e,e=i,i=null):t=n}return e=e||function(){},"function"==typeof i&&(i=r,r=o),r?h(n,t,e,i):setTimeout(function(){h(n,t,e,i)},4),p},p.config=function(t){return p(t)},t._defined=g,i=function(t,e,i){if("string"!=typeof t)throw new Error("See almond README: incorrect module build, no module name");e.splice||(i=e,e=[]),r(g,t)||r(v,t)||(v[t]=[t,e,i])},i.amd={jQuery:!0}}(),i("constants",{version:"2.0.9",base_url:"https://api.ciuvo.com/api/",media_host_url:"https://ciuvo.com/",get_url:function(t,e){switch(t){case"api":return e.base_url||this.base_url;case"storage":return(e.media_host_url||this.media_host_url)+"ciuvo/globalstorage";case"bundle":return(e.media_host_url||this.media_host_url)+"ciuvo/templates/";case"media":return e.media_host_url||this.media_host_url;case"analyze":return(e.base_url||this.base_url)+"analyze";case"voucher":return(e.base_url||this.base_url)+"voucher";case"whitelist":return(e.base_url||this.base_url)+"whitelist";default:throw"invalid url specifier"}}}),i("request",[],function(){var t=200,e="XDR",i="XHR",n=function(t,n,r){if(this.method=t,this.url=n,this.requestTimer=void 0,this.type=i,this.rq=new window.XMLHttpRequest,"withCredentials"in this.rq||"undefined"!=typeof window.XDomainRequest&&(this.type=e,this.rq=new window.XDomainRequest,this.rq.readyState=1),"object"==typeof r){var o=-1===this.url.indexOf("?")?"?":"&";for(var s in r)"undefined"!=typeof r[s]&&(this.url+=o+s+"="+encodeURIComponent(r[s]),o="&")}this.rq.open(t,this.url,!0),this.type===e&&(this.rq.onprogress=function(){},this.rq.ontimeout=function(){},this.rq.onerror=function(){},this.rq.onload=function(){},this.rq.timeout=0)};return n.prototype={wrapCallback:function(t){var e=this;return function(i){e.clearTimeout(),t(e.rq,i)}},onReadyStateChange:function(t){this.type===e?(this.rq.readyState=3,this.rq.status=200,this.rq.onload=this.wrapCallback(t)):this.rq.onreadystatechange=this.wrapCallback(t)},onLoad:function(t){this.type===e&&(this.rq.readyState=3,this.rq.status=200),this.rq.onload=this.wrapCallback(t)},onError:function(t){this.type===e&&(this.rq.readyState=3,this.rq.status=500),this.rq.onerror=this.wrapCallback(t)},setHeader:function(t,e){"setRequestHeader"in this.rq&&this.rq.setRequestHeader(t,e)},setTimeout:function(t,e){this.timeout=t,this.timeoutCallback=e},abort:function(){this.rq&&this.rq.abort()},setupTimeoutTimer:function(t){if("number"==typeof t){var e=this;window.setTimeout(function(){e.rq.abort(),"function"==typeof e.timeoutCallback&&e.timeoutCallback()},t)}},clearTimeout:function(){window.clearTimeout(this.requestTimer),this.requestTimer=void 0},send:function(i){var n=this;this.setupTimeoutTimer(this.timeout),this.type===e?window.setTimeout(function(){n.rq.send(i)},t):this.rq.send(i)}},{AjaxRequest:n}}),i("utils",[],function(){function t(t,e){return t===e?0:e>t?-1:1}function e(e,i){var n=t;return e&&(n=function(i,n){return t(e(i),e(n))}),i?function(t,e){return-1*n(t,e)}:n}function i(){for(var t=[],e="0123456789ABCDEF",i=0;36>i;i++)t[i]=Math.floor(16*Math.random());for(t[14]=4,t[19]=3&t[19]|8,i=0;36>i;i++)t[i]=e[t[i]];return t[8]=t[13]=t[18]=t[23]="-",t.join("")}function n(t){for(var e in t)if(t.hasOwnProperty(e))return!1;return JSON.stringify(t)===JSON.stringify({})}return{getHostname:function(t){return t.match(/^(https?:\/\/.*?(?::\d+)?\/)/)[1]},sort:function(i){for(var n,r,o,s=[],u=1;u<arguments.length;u++)n=arguments[u],"string"==typeof n?(r=n,o=t):(r=n.name,o=e(n.primer,n.reverse)),s.push({name:r,cmp:o});var a=function(t,e){for(var i=0,n=0;n<s.length;n++){
var r=s[n];if("undefined"!=typeof t[r.name]&&(i=r.cmp(t[r.name],e[r.name]),0!==i))break}return i};i.sort(a)},makeRandomString:function(t){for(var e="",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",n=0;t>n;n++)e+=i.charAt(Math.floor(Math.random()*i.length));return e},settings_sanity_check:function(t){if("object"!=typeof t)throw"settings must be object";if(!t.tag)throw"settings.tag is mandatory";"about:blank"===t.url&&(t.url=void 0)},generateRandomUUID:i,isEmptyObject:n}}),i("whitelist",["constants","request","utils"],function(t,e,i){var n=function(e){i.settings_sanity_check(e),this.settings=e,this.partner_tag=this.settings.tag,this.whitelist_url=t.get_url("whitelist",e)};return n.prototype={isWhitelisted:function(t,e,i){if("function"!=typeof e)throw"callback must be function";if("function"!=typeof i)throw"errback must be function";if("string"!=typeof t)throw"url must be a valid string";var n=this.cached_whitelist;if("undefined"!=typeof n&&n.length)this._isWhitelisted(t,n,e,i);else{var r=this;this._loadWhitelist(function(n){r.cached_whitelist=n,r._isWhitelisted(t,n,e,i)},i)}},updateSettings:function(t,e){for(var i=["media_url","event_url","toolbar_template","partner_tag"],n=[],r=0;r<i.length;r++){var o=i[r];e.hasOwnProperty(o)&&e[o]!==com.ciuvo.setting(o)&&(t[o]=e[o],n.push(o))}return n},_isWhitelisted:function(t,e,i,n){this._urlInList(t,e)?i():n()},_loadWhitelist:function(i,n){var r=this,o=this.whitelist_url+"?o=lcs&v="+encodeURIComponent(t.version)+"&uuid="+encodeURIComponent(this.settings.uuid)+"&tag="+encodeURIComponent(this.partner_tag)+"&campaign="+encodeURIComponent(this.settings.campaign);if(this.settings["com.ciuvo."+this.partner_tag+"-settings"]){var s=JSON.parse(this.settings["com.ciuvo.ciuvo-settings"]);"undefined"!=typeof s&&(o+="&cfg="+encodeURIComponent(s))}var u=new e.AjaxRequest("GET",o);u.jsonp="whitelist",u.onLoad(function(t){try{var e=t.jsonpResponse||JSON.parse(t.responseText),o=e["com.ciuvo.lcs"]||r._parseList(e["com.ciuvo.whitelist"]);r.updateSettings(r.settings,e),i(o)}catch(s){n(s)}}),u.onError(function(t){n(t)}),u.send(null)},_parseList:function(t){var e=[];if("undefined"==typeof t)return e;for(var i=0,n=t.length;n>i;i++){var r=new RegExp(t[i]);e.push(r)}return e},_urlInList:function(t,e){for(var i=t.match(/^(https?:\/\/.*?\/)/)[1].toLowerCase(),n=0,r=e.length;r>n;n++)if(i.indexOf(e[n])>-1)return!0;return!1}},{Whitelist:n}}),i("ciuvoSDK",["constants"],function(t){var i={version:t.version};return e(["whitelist"]),i.Whitelist=e("whitelist").Whitelist,i}),e("ciuvoSDK")});
//# sourceMappingURL=https://secure.ciuvo.com/media/bookmarklet/ciuvo-whitelist.min.js.map
